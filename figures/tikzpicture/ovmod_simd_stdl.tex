\documentclass[tikz,border=0cm,dvipsnames,x11names,rgb]{standalone}

\input{../stdl_preamble.tex}

\begin{document}

\begin{tikzpicture} [-latex,
    >=latex,
    auto,
    very thick,
    every node/.style={font={\Large}},
    main node/.style={rectangle, fill = white!35, draw,
        align=center}]




  \node [main node,
    fill = blue!40!white,
    minimum size = 1cm
  ] (ccsk0) at (0, 0) {$0$};
  \node [main node,
    fill = blue!40!white,
    minimum size = 1cm
  ] (ccsk1) at (1cm, 0) {$0$};
  \node [main node,
    fill = red!40!white,
    minimum size = 1cm
  ] (ccsk2) at (2cm, 0) {$1$};
  \node [main node,
    fill = blue!40!white,
    minimum size = 1cm
  ] (ccsk3) at (3cm, 0) {$0$};


  \node [main node,
    draw = none,
    minimum size = 1cm,
    anchor=north west,
    align = center
  ] (in) at ($(ccsk3.south east) + (1,-1)$) {$B(i)$\\($1$ bit)};


  \node [main node,
    fill=blue!40!white,
    anchor=north east,
    minimum size = 1cm
  ] (symb3) at ($(in.south west)    + (-1,-1)$) {$0$};
  \node [main node,
    fill=red!40!white,
    minimum size = 1cm,
    anchor=north east,
  ] (symb2) at ($(symb3.north east) + (-1, 0)$) {$1$};
  \node [main node,
    fill=blue!40!white,
    minimum size = 1cm,
    anchor=north east,
  ] (symb1) at ($(symb2.north east) + (-1, 0)$) {$0$};
  \node [main node,
    fill=blue!40!white,
    minimum size = 1cm,
    anchor=north east,
  ] (symb0) at ($(symb1.north east) + (-1, 0)$) {$0$};


  \node [main node,
    minimum width = 4cm,
  ] (map) at (ccsk1.east |- in.west) {$\overline{\mathrm{XOR}}$};

  \foreach \x in {0,1,3}
    {
      \node [draw,
        fill=red!40!white,
        anchor = north,
        minimum size = 1cm,
      ] (symbb\x) at ($(symb\x.south) + (0, -1pt)$){$1$};
    }
  \node [draw,
    fill=blue!40!white,
    anchor = north,
    minimum size = 1cm,
  ] (symbb2) at ($(symb2.south) + (0, -1pt)$){$0$};

  \foreach \x in {0,1,2,3}
    {
      \draw (ccsk\x.south) -- (symb\x.north |- map.north);
    }

  \foreach \x in {0,1,2,3}
    {
      \draw (ccsk\x.south |- map.south) -- (symb\x.north);
    }

  \draw (in.west) -- (map.east);

  \node[anchor = west, align = center] at (symb3.east)  {If $B(i) = 1$,};
  \node[anchor = west, align = center] at (symbb3.east) {if $B(i) = 0$.};

  \node[anchor = south, align = center] at (ccsk1.north east) {$i^{\textrm{th}}$ CCSK Symbol\\($q$ chips)};
  \node[anchor = north, align = center] at (symbb2.south west) {$i^{\textrm{th}}$ QCSP Symbol\\($q$ chips)};

\end{tikzpicture}
\end{document}
